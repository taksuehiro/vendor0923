# ビルド & Push
docker build -t vendor1007-2-api:rev15 -f Dockerfile.api .
docker tag vendor1007-2-api:rev15 067717894185.dkr.ecr.ap-northeast-1.amazonaws.com/vendor1007-2-api:rev15
aws ecr get-login-password --region ap-northeast-1 | docker login --username AWS --password-stdin 067717894185.dkr.ecr.ap-northeast-1.amazonaws.com
docker push 067717894185.dkr.ecr.ap-northeast-1.amazonaws.com/vendor1007-2-api:rev15

# タスク定義を再登録（:rev15 のまま）
aws ecs register-task-definition --cli-input-json file://ecs_taskdef.json --region ap-northeast-1

# 新リビジョン確認
aws ecs describe-task-definition --task-definition vendor1007-2-task --region ap-northeast-1 --query "taskDefinition.revision"

# ロールアウト
aws ecs update-service \
  --cluster vendor1007-2-cluster \
  --service vendor1007-2-service \
  --task-definition vendor1007-2-task:<新しい番号> \
  --force-new-deployment \
  --region ap-northeast-1

#　確認
aws ecs describe-services   --cluster vendor1007-2-cluster   --services vendor1007-2-service   --query "services[0].deployments[*].[status, taskDefinition, rolloutState, updatedAt]"   --output table